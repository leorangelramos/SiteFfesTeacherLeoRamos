<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Treino de Listening em inglês: Múltipla Escolha | Professor Leo Ramos</title>
    <meta name="description" content="Teste sua compreensão auditiva em inglês. Ouça a frase e escolha a opção correta. Exercício interativo com feedback imediato.">
    <meta name="author" content="Leo Ramos">
    <meta name="robots" content="index, follow">
    
    <link rel="canonical" href="https://teacherleoramos.com.br/ExListen/listening.html">
    
    <link rel="icon" type="image/png" sizes="32x32" href="../Images/logofavicion.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../Images/logofavicion.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../Images/logofavicion.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../Images/logofavicion.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../Images/logofavicion.png">

    <meta property="og:title" content="Listening Challenge: O que você ouviu?">
    <meta property="og:description" content="Ouça o áudio e escolha a frase correta. Teste seu inglês auditivo agora.">
    <meta property="og:image" content="https://teacherleoramos.com.br/Images/preview-social.jpg">
    <meta property="og:url" content="https://teacherleoramos.com.br/ExListen/listening.html">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="pt_BR">
    <meta property="og:site_name" content="FFES - Professor Leo Ramos">
   
    <link rel="stylesheet" href="../CSS/universal.css"> 

    <style>
        /* Banner (Padrão das outras páginas) */
        .content-banner {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }
        .content-banner h2 {
            color: var(--cor-texto-claro); 
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.6);
        }
        .content-banner p {
            color: #ecf0f1;
            font-size: 1.15em;
            margin-bottom: 20px;
        }

        /* Área de Seleção de Nível */
        .level-selection-area {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn-level {
            padding: 12px 20px;
            background-color: var(--cor-primaria);
            color: var(--cor-texto-claro);
            border: 2px solid var(--cor-acento);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .btn-level:hover {
            background-color: var(--cor-primaria-hover);
            transform: translateY(-2px);
        }

        .btn-level.active {
            background-color: var(--cor-acento);
            color: var(--cor-primaria);
            border-color: var(--cor-primaria);
        }

        /* Container do Jogo */
        .listening-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
            border-top: 6px solid var(--cor-acento);
            
            /* Oculta inicialmente */
            opacity: 0;
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            overflow: hidden;
            transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
        }
        
        .listening-container.visible {
            opacity: 1;
            max-height: 2000px; 
            padding: 30px;
        }

        /* Botão principal de Áudio */
        .btn-audio {
            background-color: var(--cor-primaria);
            color: var(--cor-texto-claro);
            padding: 20px 40px;
            font-size: 1.5em;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .btn-audio:hover:not(:disabled) {
            background-color: var(--cor-primaria-hover);
            transform: scale(1.05);
        }

        .btn-audio:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        /* Estilo das Opções de Múltipla Escolha (Copiado do universal.css - option-button) */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }

        .option-button {
            width: 100%;
            padding: 15px;
            font-size: 1em;
            text-align: left;
            background-color: var(--cor-fundo-geral);
            border: 2px solid var(--cor-borda-sutil);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.2s ease;
            box-sizing: border-box; /* Garante que o padding não aumente o tamanho */
        }

        .option-button:not(:disabled):hover {
            background-color: #e0e0e0;
            border-color: var(--cor-acento);
        }

        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .option-button.correto {
            background-color: var(--cor-sucesso);
            border-color: #27ae60;
            color: white;
            font-weight: bold;
        }

        .option-button.incorreto {
            background-color: var(--cor-erro);
            border-color: #c0392b;
            color: white;
            font-weight: bold;
        }

        /* Feedback (Padrão) */
        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: normal;
            display: none;
            text-align: center;
        }
        
        .feedback-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .feedback-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .action-area-bottom {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
    </style>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Treino de Listening: Múltipla Escolha",
      "description": "Exercício interativo para testar a compreensão auditiva em inglês com áudios gerados por síntese de voz.",
      "url": "https://teacherleoramos.com.br/ExListen/listening.html",
      "author": {
        "@type": "Person",
        "name": "Leo Ramos"
      },
      "applicationCategory": "EducationalApplication",
      "provider": {
        "@type": "ProfessionalService",
        "name": "FFES - Professor Leo Ramos"
      }
    }
    </script>
</head>
<body>

<div class="cabecalho-container">
    <header class="bloco-identidade">
        <div class="logo-and-title">
            <a href="../index.html">
                <img src="../Images/logo novo grande.png" alt="Logo FFES" class="logo-img">
            </a>
            <a href="../index.html" style="text-decoration: none; color: inherit;">
                <h1>Leo Ramos | Professor de Inglês</h1>
            </a>
        </div>
    </header>

<div class="bloco-navegacao"> 
    <nav class="nav-primary">
        <ul>
            <li><a href="/index.html#home">Home</a></li>
            <li><a href="/index.html#sobre">Sobre Mim</a></li>
            <li><a href="/exercicios-e-artigos.html#exercicios">Exercícios</a></li>
            <li><a href="/exercicios-e-artigos.html#artigos-vocab">Artigos</a></li>
            <li><a href="/cursos-e-ebook.html#cursos">Cursos e E-book</a></li>
            <li><a href="/index.html#metodologia">Metodologia</a></li>
        </ul>
    </nav>
</div>


</div>

<main>
    <section class="content-banner">
        <h2>Listening Challenge - O que você ouviu?</h2>
        <p>Ouça atentamente a frase e selecione a opção que corresponde exatamente ao que foi dito.</p>
        
        <div class="level-selection-area">
            <button class="btn-level" data-level="A1" onclick="selectLevel('A1', this)">A1 Básico</button>
            <button class="btn-level" data-level="A2" onclick="selectLevel('A2', this)">A2 Pré-Intermediário</button>
        </div>

        <div id="listening-container" class="listening-container">
            
            <p id="level-info" style="font-style: italic; margin-bottom: 20px; color: #666;"></p>

            <button class="btn-audio" id="play-audio-button" onclick="playAudio()" disabled>
                <span style="font-size: 1.5em;">▶</span> Tocar Áudio
            </button>

            <div id="options-container" class="options-container">
                <p style="color: #999;">Opções de resposta aparecerão aqui.</p>
            </div>

            <div id="feedback-display" class="feedback-area"></div>
            
            <div class="action-area-bottom">
                <button class="cta-button" id="next-button" onclick="loadNextQuestion()" disabled>→ Próximo Áudio</button>
            </div>
            
            <div style="margin-top: 20px; font-size: 0.9em; color: #7f8c8d;">
                Questão <span id="q-current">--</span> de <span id="q-total">--</span>
            </div>

        </div>
    </section>
</main>

<footer id="contato" class="site-footer">
    <div class="footer-content">
        <div class="social-media-links">
            <h4>Siga-me nas redes sociais</h4>
            <a href="https://www.youtube.com/@teacherleoramos" target="_blank" rel="noopener noreferrer" title="YouTube"><img src="https://img.icons8.com/ios-filled/50/ffffff/youtube-play.png" alt="YouTube"></a>
            <a href="https://www.instagram.com/teacherleoramos/" target="_blank" rel="noopener noreferrer" title="Instagram"><img src="https://img.icons8.com/ios-filled/50/ffffff/instagram-new.png" alt="Instagram"></a>
            <a href="https://www.tiktok.com/@teacherleoramos" target="_blank" rel="noopener noreferrer" title="TikTok"><img src="https://img.icons8.com/ios-filled/50/ffffff/tiktok.png" alt="TikTok"></a>
            <a href="https://wa.me/5511955582118" target="_blank" rel="noopener noreferrer" title="WhatsApp"><img src="https://img.icons8.com/ios-filled/50/ffffff/whatsapp--v1.png" alt="WhatsApp"></a>
        </div>
        <p><strong>Contato</strong></p>
        <p>Youtube: @teacherleoramos | Telefone - WhatsApp: (11) 95558-2118</p>
        <p>Endereço: São Paulo, SP, Brasil</p>
        <p>CNPJ: 43.226.983/0001-91</p>
        <p>&copy; 2025 | FEATHERED FRIENDS ENGLISH SCHOOL - FFES. Todos os direitos reservados.</p>
    </div>
</footer>

<script>
    // --- BANCO DE QUESTÕES DE LISTENING ---
    // Estrutura: { level: 'Ax', correct: 'Frase Correta', distractors: ['Erro Gramatical/Semântico', 'Erro Vocabular/Fônico'] }
    const allQuestions = [
        
        // =========================================
        //                 NÍVEL A1 (50 Frases)
        // =========================================
        { level: 'A1', correct: "I am a student.", distractors: ["I have a student.", "I am student."] },
        { level: 'A1', correct: "She is happy today.", distractors: ["She are happy today.", "She happy today."] },
        { level: 'A1', correct: "Do you speak English?", distractors: ["You speak English?", "Does you speak English?"] },
        { level: 'A1', correct: "We go to work by bus.", distractors: ["We goes to work by bus.", "We go to work on bus."] },
        { level: 'A1', correct: "I don't like milk.", distractors: ["I not like milk.", "I doesn't like milk."] },
        { level: 'A1', correct: "What is your name?", distractors: ["What your name is?", "What are your name?"] },
        { level: 'A1', correct: "It is six o'clock.", distractors: ["It has six o'clock.", "Is it six o'clock."] },
        { level: 'A1', correct: "I need help.", distractors: ["I needs help.", "I need a help."] },
        { level: 'A1', correct: "Where are you from?", distractors: ["Where you are from?", "From where are you?"] },
        { level: 'A1', correct: "How much is this book?", distractors: ["How many is this book?", "How cost this book?"] },
        { level: 'A1', correct: "I want an apple.", distractors: ["I want a apple.", "I want one apple."] },
        { level: 'A1', correct: "He is 25 years old.", distractors: ["He has 25 years old.", "He is 25 years."] },
        { level: 'A1', correct: "They are at the park.", distractors: ["They is at the park.", "They are in the park."] },
        { level: 'A1', correct: "I live in a small apartment.", distractors: ["I live on a small apartment.", "I living in a small apartment."] },
        { level: 'A1', correct: "Does she like pizza?", distractors: ["Do she like pizza?", "She likes pizza?"] },
        { level: 'A1', correct: "The cat is on the table.", distractors: ["The cat is in the table.", "The cat on the table."] },
        { level: 'A1', correct: "We were tired yesterday.", distractors: ["We was tired yesterday.", "We are tired yesterday."] },
        { level: 'A1', correct: "I saw him last night.", distractors: ["I see him last night.", "I seen him last night."] },
        { level: 'A1', correct: "Did you go to the store?", distractors: ["Did you went to the store?", "You did go to the store?"] },
        { level: 'A1', correct: "She ate lunch at noon.", distractors: ["She eat lunch at noon.", "She lunch at noon."] },
        { level: 'A1', correct: "I walked home quickly.", distractors: ["I walk home quickly.", "I walked home quick."] },
        { level: 'A1', correct: "Can you close the door?", distractors: ["You can close the door?", "Can you closing the door?"] },
        { level: 'A1', correct: "We are watching TV now.", distractors: ["We watch TV now.", "We is watching TV now."] },
        { level: 'A1', correct: "What are you doing?", distractors: ["What you are doing?", "What do you do?"] },
        { level: 'A1', correct: "They are playing outside.", distractors: ["They is playing outside.", "They playing outside."] },
        { level: 'A1', correct: "It is raining heavily.", distractors: ["It is rain heavily.", "It raining heavily."] },
        { level: 'A1', correct: "I am feeling sick.", distractors: ["I feel sick.", "I am feel sick."] },
        { level: 'A1', correct: "Where is the library?", distractors: ["Where the library is?", "Where are the library?"] },
        { level: 'A1', correct: "There are two books.", distractors: ["There is two books.", "Is there two books?"] },
        { level: 'A1', correct: "Is there a problem?", distractors: ["Are there a problem?", "There is a problem?"] },
        { level: 'A1', correct: "I have two sisters.", distractors: ["I has two sisters.", "I have two sister."] },
        { level: 'A1', correct: "This is her dog.", distractors: ["This is his dog.", "This is she dog."] },
        { level: 'A1', correct: "The bag is theirs.", distractors: ["The bag is their.", "The bag is them."] },
        { level: 'A1', correct: "Give the keys to me.", distractors: ["Give the keys me.", "Give me the key."] },
        { level: 'A1', correct: "She sings well.", distractors: ["She sings good.", "She sings happily."] },
        { level: 'A1', correct: "I am thirsty.", distractors: ["I have thirsty.", "I am feeling thirsty."] },
        { level: 'A1', correct: "We went shopping.", distractors: ["We go shopping.", "We did went shopping."] },
        { level: 'A1', correct: "He is my father.", distractors: ["He my father.", "He is father."] },
        { level: 'A1', correct: "I usually read books.", distractors: ["I read usually books.", "I am usually reading books."] },
        { level: 'A1', correct: "Don't forget your coat.", distractors: ["Not forget your coat.", "Don't forgets your coat."] },
        { level: 'A1', correct: "I am cold.", distractors: ["I have cold.", "I am coldness."] },
        { level: 'A1', correct: "Can I help you?", distractors: ["I can help you?", "Can helping you?"] },
        { level: 'A1', correct: "The water is hot.", distractors: ["The water are hot.", "The water hot."] },
        { level: 'A1', correct: "She needs to rest.", distractors: ["She need to rest.", "She needs rest."] },
        { level: 'A1', correct: "I live on this street.", distractors: ["I live in this street.", "I live to this street."] },
        { level: 'A1', correct: "Is he your brother?", distractors: ["He is your brother?", "Are he your brother?"] },
        { level: 'A1', correct: "We bought a house.", distractors: ["We buyed a house.", "We are buying a house."] },
        { level: 'A1', correct: "He runs fast.", distractors: ["He run fast.", "He is running fast."] },
        { level: 'A1', correct: "I am happy.", distractors: ["I am happiness.", "I has happy."] },
        { level: 'A1', correct: "Please, hurry up!", distractors: ["Please, hurry.", "Please, quick up!"] },
        
        // =========================================
        //                 NÍVEL A2 (50 Frases)
        // =========================================
        { level: 'A2', correct: "I have lived here since 2018.", distractors: ["I live here since 2018.", "I am living here since 2018."] },
        { level: 'A2', correct: "She has gone to the store.", distractors: ["She has been to the store.", "She went to the store."] },
        { level: 'A2', correct: "Have you ever seen a ghost?", distractors: ["Did you ever saw a ghost?", "Do you ever seen a ghost?"] },
        { level: 'A2', correct: "I was sleeping when the phone rang.", distractors: ["I slept when the phone rang.", "I am sleeping when the phone rang."] },
        { level: 'A2', correct: "They were playing soccer at 3 pm.", distractors: ["They played soccer at 3 pm.", "They are playing soccer at 3 pm."] },
        { level: 'A2', correct: "You must study for the test.", distractors: ["You must to study for the test.", "You should studying for the test."] },
        { level: 'A2', correct: "I can't swim very well.", distractors: ["I cannot to swim very well.", "I can't swimming very well."] },
        { level: 'A2', correct: "We should talk about the problem.", distractors: ["We should to talk about the problem.", "We should talking about the problem."] },
        { level: 'A2', correct: "It depends on the traffic.", distractors: ["It depends of the traffic.", "It depends to the traffic."] },
        { level: 'A2', correct: "I look forward to hearing from you.", distractors: ["I look forward to hear from you.", "I look forward to listen to you."] },
        { level: 'A2', correct: "She decided to quit her job.", distractors: ["She decided quitting her job.", "She decided quit her job."] },
        { level: 'A2', correct: "I enjoy watching movies.", distractors: ["I enjoy to watch movies.", "I enjoys watching movies."] },
        { level: 'A2', correct: "Can you explain this to me?", distractors: ["Can you explain me this?", "Can you explain this for me?"] },
        { level: 'A2', correct: "I went to the bank to pay the bills.", distractors: ["I went to the bank for pay the bills.", "I went to the bank and pay the bills."] },
        { level: 'A2', correct: "I need some advice.", distractors: ["I need an advice.", "I need few advice."] },
        { level: 'A2', correct: "Life is beautiful.", distractors: ["The life is beautiful.", "A life is beautiful."] },
        { level: 'A2', correct: "He is a great engineer.", distractors: ["He is great engineer.", "He is engineer."] },
        { level: 'A2', correct: "It was such a cold day.", distractors: ["It was so a cold day.", "It was such cold day."] },
        { level: 'A2', correct: "She is so friendly.", distractors: ["She is such friendly.", "She is too friendly."] },
        { level: 'A2', correct: "He drives his car carefully.", distractors: ["He drives his car careful.", "He drives careful his car."] },
        { level: 'A2', correct: "I am always tired.", distractors: ["I always am tired.", "I am tired always."] },
        { level: 'A2', correct: "The vase was broken by the child.", distractors: ["The vase broke by the child.", "The vase was break by the child."] },
        { level: 'A2', correct: "The report has been sent.", distractors: ["The report have been sent.", "The report was send."] },
        { level: 'A2', correct: "If I were rich, I would travel.", distractors: ["If I was rich, I would travel.", "If I am rich, I would travel."] },
        { level: 'A2', correct: "If it snows, the flight will be canceled.", distractors: ["If it will snow, the flight will be canceled.", "If it snow, the flight will be canceled."] },
        { level: 'A2', correct: "What would you do if you lost your phone?", distractors: ["What you would do if you lost your phone?", "What will you do if you lost your phone?"] },
        { level: 'A2', correct: "They said they were fine.", distractors: ["They said they are fine.", "They told they were fine."] },
        { level: 'A2', correct: "She told me she left early.", distractors: ["She said me she left early.", "She told to me she left early."] },
        { level: 'A2', correct: "I asked where he lived.", distractors: ["I asked where did he live.", "I asked where he lives."] },
        { level: 'A2', correct: "The car is newer than mine.", distractors: ["The car is more newer than mine.", "The car is new than mine."] },
        { level: 'A2', correct: "He is the smartest student.", distractors: ["He is most smart student.", "He is the smarter student."] },
        { level: 'A2', correct: "I have too many worries.", distractors: ["I have too much worries.", "I have too many worry."] },
        { level: 'A2', correct: "There is too much noise.", distractors: ["There are too much noise.", "There is too many noise."] },
        { level: 'A2', correct: "I don't have enough time.", distractors: ["I don't have time enough.", "I don't have too time."] },
        { level: 'A2', correct: "She is tired, so she went to bed.", distractors: ["She is tired, so went to bed.", "She is tired, so she go to bed."] },
        { level: 'A2', correct: "I missed the train.", distractors: ["I lost the train.", "I missed the bus."] },
        { level: 'A2', correct: "I need to take a break.", distractors: ["I need to take break.", "I need take a break."] },
        { level: 'A2', correct: "They prefer tea over coffee.", distractors: ["They prefer tea than coffee.", "They prefer tea to coffee."] },
        { level: 'A2', correct: "I am fed up with this mess.", distractors: ["I am fed up of this mess.", "I am fed with this mess."] },
        { level: 'A2', correct: "We saw a beautiful red flower.", distractors: ["We saw a red beautiful flower.", "We saw a flower red beautiful."] },
        { level: 'A2', correct: "The computer broke down.", distractors: ["The computer break down.", "The computer was broke down."] },
        { level: 'A2', correct: "I look like my mother.", distractors: ["I look my mother.", "I look to my mother."] },
        { level: 'A2', correct: "I am excited about the trip.", distractors: ["I am excited with the trip.", "I am exciting about the trip."] },
        { level: 'A2', correct: "The movie started ten minutes ago.", distractors: ["The movie has started ten minutes ago.", "The movie started before ten minutes."] },
        { level: 'A2', correct: "She began to cry.", distractors: ["She begun to cry.", "She beginning to cry."] },
        { level: 'A2', correct: "Did you put the book there?", distractors: ["Did you putted the book there?", "You put the book there?"] },
        { level: 'A2', correct: "I hope to see you soon.", distractors: ["I hope seeing you soon.", "I hope that see you soon."] },
        { level: 'A2', correct: "It is dangerous to walk alone.", distractors: ["It is dangerous walk alone.", "It is a dangerous to walk alone."] },
        { level: 'A2', correct: "I am ready to leave.", distractors: ["I am ready for leave.", "I am ready leaving."] },
        { level: 'A2', correct: "We must hurry.", distractors: ["We must to hurry.", "We must hurried."] }

    ];

    let currentLevel = null;
    let filteredQuestions = [];
    let currentQuestion = null;
    let answeredQuestions = new Set(); 

    const listeningContainer = document.getElementById('listening-container');
    const optionsContainer = document.getElementById('options-container');
    const feedbackEl = document.getElementById('feedback-display');
    const levelInfo = document.getElementById('level-info');
    const playAudioButton = document.getElementById('play-audio-button');
    const nextButton = document.getElementById('next-button');
    const countCurrent = document.getElementById('q-current');
    const countTotal = document.getElementById('q-total');
    let isSpeaking = false; // Flag para controlar o áudio

    // Inicialização ao carregar a página
    document.addEventListener('DOMContentLoaded', () => {
        optionsContainer.innerHTML = '<p style="color: #999;">Opções de resposta aparecerão aqui.</p>';
        countCurrent.textContent = '--';
        countTotal.textContent = '--';
        levelInfo.textContent = '';
        listeningContainer.classList.remove('visible');
        playAudioButton.disabled = true;
        nextButton.disabled = true;
        nextButton.style.backgroundColor = '#95a5a6';
    });


    // Função para selecionar o nível
    window.selectLevel = function(level, button) {
        // Remove a classe 'active' de todos os botões e adiciona ao clicado
        document.querySelectorAll('.btn-level').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        currentLevel = level;
        filteredQuestions = allQuestions.filter(q => q.level === level);
        answeredQuestions.clear(); 

        if (filteredQuestions.length > 0) {
            listeningContainer.classList.add('visible');
            playAudioButton.disabled = false;
            nextButton.disabled = false;
            nextButton.style.backgroundColor = 'var(--cor-acento)';

            levelInfo.innerHTML = `<strong>Nível: ${currentLevel} (${filteredQuestions.length} frases disponíveis)</strong>. Ouça e escolha a opção correta.`;
            loadNextQuestion(); // Carrega a primeira questão
        } else {
            listeningContainer.classList.remove('visible');
            optionsContainer.innerHTML = '<p style="color: red;">Nenhuma questão disponível para este nível.</p>';
        }

        document.getElementById('listening-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Função para embaralhar array (Fisher-Yates Shuffle)
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    // Carrega a próxima questão (aleatória e não repetida)
    window.loadNextQuestion = function() {
        if (!currentLevel || filteredQuestions.length === 0) return;

        // Se todas as questões foram respondidas, recomeça o ciclo
        if (answeredQuestions.size === filteredQuestions.length) {
            answeredQuestions.clear();
        }

        let availableQuestions = filteredQuestions.filter(q => !answeredQuestions.has(q));
        if (availableQuestions.length === 0) availableQuestions = filteredQuestions;

        const randomIndex = Math.floor(Math.random() * availableQuestions.length);
        currentQuestion = availableQuestions[randomIndex];

        // Prepara as opções e embaralha
        const options = [...currentQuestion.distractors, currentQuestion.correct];
        const shuffledOptions = shuffle(options);

        renderOptions(shuffledOptions);
        feedbackEl.style.display = 'none';
        
        // Atualiza contagem
        countTotal.textContent = filteredQuestions.length;
        countCurrent.textContent = Array.from(answeredQuestions).length + 1;

        // Habilita áudio e toca automaticamente a primeira vez
        playAudioButton.disabled = false;
        playAudio(); 
    }

    // Renderiza as opções na tela
    function renderOptions(options) {
        optionsContainer.innerHTML = '';
        options.forEach(option => {
            const button = document.createElement('button');
            button.className = 'option-button';
            button.textContent = option;
            button.onclick = () => checkAnswer(button, option);
            optionsContainer.appendChild(button);
        });
    }

    // Toca o áudio
    window.playAudio = function() {
        if (!currentQuestion || isSpeaking) return;

        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(currentQuestion.correct);
            utterance.lang = 'en-US';
            utterance.rate = 1.0; 
            
            // Adiciona um listener para a flag de speaking
            utterance.onstart = () => { isSpeaking = true; playAudioButton.disabled = true; };
            utterance.onend = () => { isSpeaking = false; playAudioButton.disabled = false; };

            window.speechSynthesis.speak(utterance);
        } else {
            alert("Seu navegador não suporta áudio de leitura (Speech Synthesis).");
        }
    }
    
    // Verifica a resposta
    function checkAnswer(selectedButton, selectedOption) {
        // Desabilita todos os botões após a escolha
        document.querySelectorAll('.option-button').forEach(btn => btn.disabled = true);

        feedbackEl.style.display = 'block';

        if (selectedOption === currentQuestion.correct) {
            selectedButton.classList.add('correto');
            feedbackEl.className = 'feedback-area feedback-success';
            feedbackEl.innerHTML = `
                <strong>✔ Correto!</strong><br>
                A frase que você ouviu foi: <em>"${currentQuestion.correct}"</em>
            `;
            answeredQuestions.add(currentQuestion);
            
            // Força a atualização do número da questão se acertou
            countCurrent.textContent = Math.min(Array.from(answeredQuestions).length + 1, filteredQuestions.length);
        } else {
            selectedButton.classList.add('incorreto');
            // Encontra e destaca a resposta correta
            document.querySelectorAll('.option-button').forEach(btn => {
                if (btn.textContent === currentQuestion.correct) {
                    btn.classList.add('correto');
                }
            });
            
            feedbackEl.className = 'feedback-area feedback-error';
            feedbackEl.innerHTML = `
                <strong>✖ Incorreto.</strong><br>
                A resposta correta é: <em>"${currentQuestion.correct}"</em>
            `;
        }
    }

</script>

</body>
</html>